<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<section id="dynamicfield-database">
    <title>The Dynamic Field "Database"</title>

    <para>
        This feature implements a dynamic field of the type "Database".
    </para>

    <section>
        <title>Description</title>
        <para>
            This feature implements a generic dynamic field type, which offers the possibility to gather data from external databases.
            Such connected datasets can be searched and filtered using additional masks.
        </para>
        <para>
            Related found and marked datasets can be saved to the particular tickets through the dynamic field.
        </para>
        <para>
            'Database' dynamic fields can be created the same way, as the default dynamic fields are created.
        </para>
    </section>

    <section>
        <title>Configuration</title>
        <para>
            The following list of configuration options can be used for this feature.
        </para>
        <section>
            <title>Add a dynamic field 'Database'</title>
            <para>
                This feature implements a configuration interface to create dynamic fields of the type 'Database'.
            </para>
            <para>
                'Database' dynamic fields can be created the same way, as the default dynamic fields are created. For this switch to the
                Admin -&gt; Ticket Settings -&gt; Dynamic Fields view. In this mask you can select the 'Database' field from the ticket drop down box on the left side. Currently it's not possible to use the 'Database' dynamic field in the article context.
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        Configuration "General - Name":
                    </para>
                    <para>
                        Dynamic fields of the type 'Database' need a unique name just like other dynamic fields, too. This name has to contain only alphanumeric values. This name will be used for internal handling of the field but will not be displayed.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Configuration "General - Label":
                    </para>
                    <para>
                        The label can be individually set and can contain white spaces etc. It will be used as the field label in the different views.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Configuration "General - Field order":
                    </para>
                    <para>
                        The field order allows a administrator to change the order of created dynamic fields. If this configuration get changed the general field order will be adjusted and other dynamic fields will be moved one position back.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Configuration "General - Valid":
                    </para>
                    <para>
                        To use the dynamic field in the configured OTRS 'views' it has to be set as valid. If the field is set to 'invalid' it will disappear from all the configured views but no data will be lost.
                    </para>
                </listitem>
            </itemizedlist>
        </section>

        <section>
            <title>Configuration of the external source (Database)</title>
            <para>
                Before an external database can be searched and the results be saved at the ticket through the dynamic field,
                the credentials have to be stored in the configuration of the dynamic field.

                <figure>
                    <title>DynamicField Database Admin screen</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/AdminOverview.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                Type: The type of the desired database can be selected here. The field supports the default OTRS database
                types: MySQL, Oracle, PostgreSQL or MSSQL.
            </para>

            <itemizedlist>
                <listitem>
                    <para>
                        SID: This option is only available for Oracle connections and will be shown or hidden automatically.
                        Within this option you have to enter the SID of your Oracle connection.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Driver: This option is only available for ODBC connections and will be shown or hidden automatically.
                        Within this option you have to enter in the hostsystem previously configured ODBC driver to connect to the desired
                        MSSQL database.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Server: The database host (hostname or IP-Address).
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Port: The port of the database server.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Database: Defines the desired target database of the DBMS. This database will be used for queries.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Table / View: This table or view will be used for the queries.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        User: The username for the database connection.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Password: The user password for the database connection.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Identifier: This select box will be automatically filled through "Possible Values (description below)". This
                        field represents the value which will be stored in the dynamic field.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Multiselect: If this field is selected, it will be possible to store more than one value to the dynamic field.
                        Those values will be stored comma separated.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        CacheTTL: This value defines the period of validity of the database cache in seconds. Equal queries to the database
                        will be answered through the cache (local filesystem) within this period instead of asking the database again.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Searchprefix: This value will be put in the front of every search term while using the autocompletion to search the
                        database. Wildcard characters are supported as well. The searchprefix will be ignored during the detailed search, but
                        it is still possible to use wildcard characters in those masks.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Searchsuffix: This value will be put in the end of every search term while using the autocompletion to search the
                        database. Wildcard characters are supported as well. The searchsuffix will be ignored during the detailed search, but
                        it is still possible to use wildcard characters in those masks.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Result-Limit: The entered integer value defines the maximum amount of allowed results during a database search. This includes
                        the autocompletion search as well as the detailed search.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Case Sensitive: If this field is selected, case-sensitivity will take effect on searches.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Possible values: As already explained the possible values will fill up the identifier field automatically, which
                        defines the value that will be stored in the dynamic field. Possible values can be created as much as needed (or at
                        least as many table columns as the database table has). The possible values defines the database columns to search
                        in. It is possible to set the column name, a description (label) the field should have, the needed data type and if
                        the field should be a search- or listfield.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Name: The exact name of the database column which will be requested through the database queries.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Description: The label of the field which will be displayed in the detailed search.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Datatype: The data type which will be stored in the dynamic field. Possible values: TEXT, INTEGER or DATE.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Filter: With the filter field, it is possible to choose a ticket attribute or a dynamic field as a filter for the related
                        column. If the dynamic field is bound to a related ticket, the attributes will be used for the filter mechanism, otherwise
                        the filters will be ignored.

                        If filter will be configured to a table column, only search results matching to the search term and the related ticket attribute
                        on exactly the configured column will be displayed.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Searchfield: Indicates if a field should be included in the search requests.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Listfield: Indicates if a field should be displayed in the results.
                    </para>
                </listitem>
            </itemizedlist>
        </section>

        <section>
            <title>Configure dynamic fields of type 'Database' to be displayed in the agent interface</title>
            <para>
                Dynamic fields of type 'Database' have to be activated for the several masks in which they should be displayed
                like the other types of dynamic fields.
            </para>
            <para>
                This can be done through Admin -&gt; System Administration -&gt; SysConfig, in which "Ticket" must be selected
                on the left hand side.
            </para>
            <para>
                For every interface area (Frontend), in which the dynamic field of type 'Database' should be displayed, the admin
                has to configure it to fit his needs. Examples:
                <itemizedlist>
                    <listitem>
                        <para>
                            Frontend::Agent::Ticket::ViewZoom for the ticket zoom view.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            Frontend::Agent::Ticket::ViewPhoneNew for new phone tickets.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            Frontend::Agent::Ticket::ViewEmailNew for new email tickets.
                        </para>
                    </listitem>
                    <listitem>
                        <para>
                            In each of these view configurations is an entry called "Ticket::Frontend::AgentTicket*###DynamicField".
                            This configuration defines which dynamic field(s) should get displayed in this view. To add a dynamic field,
                            the internal name of the field has to be filled in the 'Key' field. The field 'Value' can take the values 0
                            (deactivated), 1 (active) and 2 (active and mandatory).
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>

        <section>
            <title>Storage of historical data</title>
            <para>
                This feature offers a functionality to store historical data. For this to work it´s necessary to activate and set SysConfig options,
                as visibly in the following screenshot:

                <figure>
                    <title>DynamicField Database - Historical data settings</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/SysConfigStoreHistoricalData.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                In the configuration option for the "SourceDynamicField" it´s needed to fill in the already created dynamic (Database) field name, which will
                be used to gather the historical data. In the related option "TargetDynamicField" the field(s) "Key" have to be filled with the table columns
                of the connected external database, which will be readout.
                For every column the related target dynamic field has to be configured in the field "content". The gathered data will be saved in these
                dynamic fields.
            </para>
            <para>
                If the configuration is ready and active, the configured fields will be readout from the external database, since the source field gets a
                new value via the configured masks. The data will be searched by it´s stored identifier via an event module and the found values will be
                stored in the target dynamic fields.
            </para>
        </section>

        <section>
            <title>Sysconfig settings</title>

            <variablelist>
                <varlistentry>
                    <term>AutoComplete::Agent###DynamicFieldDatabaseSearch</term>
                    <listitem>
                        <para>Group: Framework, Subgroup: Frontend::Agent</para>
                        <para>
                            Defines the config options for the autocompletion feature.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Ticket::EventModulePost###950-StoreHistoricalData</term>
                    <listitem>
                        <para>Group: Ticket, Subgroup: Core::Ticket</para>
                        <para>
                            Updates dynamic fields, if configured ones will be updated.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>DynamicFieldDatabase::StoreHistoricalData###1-SourceDynamicField1</term>
                    <listitem>
                        <para>Group: OTRSBusiness, Subgroup: Core</para>
                        <para>
                            Defines the source dynamic field for storing historical data.
                        </para>
                        </listitem>
                </varlistentry>
                <varlistentry>
                    <term>DynamicFieldDatabase::StoreHistoricalData###2-TargetDynamicFields1</term>
                    <listitem>
                        <para>Group: OTRSBusiness, Subgroup: Core</para>
                        <para>
                            Defines the target dynamic fields for storing historical data.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>DynamicFieldDatabase::StoreHistoricalData###3-SourceDynamicField2</term>
                    <listitem>
                        <para>Group: OTRSBusiness, Subgroup: Core</para>
                        <para>
                            Defines the source dynamic field for storing historical data.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>DynamicFieldDatabase::StoreHistoricalData###4-TargetDynamicFields2</term>
                    <listitem>
                        <para>Group: OTRSBusiness, Subgroup: Core</para>
                        <para>
                            Defines the target dynamic fields for storing historical data.
                        </para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
    </section>

    <!-- ******** -->
    <!-- 3. Usage -->
    <!-- ******** -->
    <section>
        <title>Usage</title>
        <para>
            An exemplary usage of DynamicField Database is as follows:
        </para>

        <section>
            <title>Searching and saving datasets - Autocompletion</title>
            <para>
                After the created dynamic fields are activated in the well known masks (like ViewPhoneNew, ViewEmailNew) a new text field
                appears with the name, the dynamic field got in the configuration.
                In this field it is possible to input searchterms and therefore execute a search over all configured database fields.
                Otherwise do a click on the link 'Detailed search' and start a detailed search in which the fields to search in are selected
                explicitly.

                <figure>
                    <title>DynamicField Database - Test field</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/SearchFieldEmpty.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                Since search terms are typed in into the text field, a database search will be started over the configured columns and the
                result will displayed via an autocompletion below the text field. The more exact the search term is, the more exact will be
                the result (less result entries).

                <figure>
                    <title>DynamicField Database - Autocomplete feature</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/SearchFieldAutoCompletion.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                If the wished value will be displayed in the results, it can be selected via a mouse click or via the keyboard and
                therefore be added to the dynamic field results.

                <figure>
                    <title>DynamicField Database - Selected items</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/SearchFieldSelected.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                Via the link 'Details' a popup screen can be accessed, which offers detailed information about the whole result row.
                This information includes the line headers and the data. This information can be used to get an overview about the
                rest (of the not configured) columns or to compare data.
            </para>
            <para>
                The added result entries can be removed via the minus button.
            </para>
        </section>
        <section>
            <title>Searching and saving datasets - Detailed search</title>
            <para>
                The link 'Detailed search' opens a new modal dialog to start a new database search. In this mask it is possible
                to select the fields to search on explicitly.

                <figure>
                    <title>DynamicField Database - Detailed search</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/DetailedSearchMask.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                By default the first available field is activated, but it´s also possible to remove available fields or add
                additional ones. Only activated and filled fields are considered for the search. Wildcard characters '*' are allowed
                in every single field.
            </para>
            <para>
                The database search will be executed via the button "Start search" and the results will be tabular displayed.
                If the search was successful, the results will be listed and one of the entries can be selected via a mouse click. The
                value will be added to the list of saved values afterwards.

                <figure>
                    <title>DynamicField Database - Detailed search result</title>
                    <screenshot>
                         <graphic scale="40" fileref="screenshots/dynamicfield-database/DetailedSearchResult.png"></graphic>
                    </screenshot>
                </figure>
            </para>
            <para>
                Independent of using the autocompletion or the detailed search, every single result can just selected ones. If an agent
                tries to select a value multiple times, a related warning message is displayed.
            </para>
        </section>
    </section>


    <!-- ********************************** -->
    <!-- 4. Technical Implementation Detail -->
    <!-- ********************************** -->
    <!-- for internal use, don't generate
    <chapter>
        <title>Technical Implementation Details</title>
        <para>
            File: Kernel/Modules/AdminDynamicFieldDatabase.pm
            Modification: The module file for the administration interface of the dynamic field.
        </para>
        <para>
            File: Kernel/Modules/AgentDynamicFieldDatabaseDetailedSearch.pm
            Modification: The module file for the detailed search.
        </para>
        <para>
            File: Kernel/Modules/AgentDynamicFieldDatabaseSearch.pm
            Modification: The module file for the AJAX-Requests of the autocompletion.
        </para>
        <para>
            File: Kernel/Output/HTML/Standard/AdminDynamicFieldDatabase.tt
            Modification: The template file for the administration interface of the dynamic field.
        </para>
        <para>
            File: Kernel/Output/HTML/Standard/AgentDynamicFieldDatabaseDetailedSearch.tt
            Modification: The template file for the detailed search.
        </para>
        <para>
            File: Kernel/System/DynamicField/Driver/BaseDatabase.pm
            Modification: The driver module for the dynamic field.
        </para>
        <para>
            File: Kernel/System/DynamicField/Driver/Database.pm
            Modification: The main module of the dynamic field.
        </para>
        <para>
            File: Kernel/System/Database.pm
            Modification: The backend module for the database queries.
        </para>
        <para>
            File: var/httpd/htdocs/js/Core.Agent.Admin.DynamicFieldDatabase.js
            Modification: Specific JavaScript for the dynamic fields.
        </para>
        <para>
            File: var/httpd/htdocs/js/Core.Agent.DynamicFieldDatabaseSearch.js
            Modification: Specific JavaScript for the search queries and their processing.
        </para>
        <para>
            File: var/httpd/htdocs/skins/Agent/default/css/DynamicFieldDatabase.css
            Modification: Design modifications for the search result illustration.
        </para>
    </chapter>
    -->

</section>
